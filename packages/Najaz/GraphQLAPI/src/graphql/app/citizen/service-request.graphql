#Shop\Citizen\ServiceRequest Related APIs
extend type Query @guard(with: ["citizen-api"]) {
    """
    جميع طلبات الخدمات التي أرسلها المواطن الحالي.
    """
    myServiceRequests(
        serviceId: Int
        status: ServiceRequestStatus
    ): [ServiceRequest!]!
        @field(resolver: "Najaz\\GraphQLAPI\\Queries\\App\\Citizen\\ServiceRequestQuery@list")

    """
    طلب خدمة محدد للمواطن الحالي.
    """
    myServiceRequest(id: ID!): ServiceRequest
        @field(resolver: "Najaz\\GraphQLAPI\\Queries\\App\\Citizen\\ServiceRequestQuery@show")
}

extend type Mutation @guard(with: ["citizen-api"]) {
    """
    إنشاء طلب خدمة جديد للمواطن الحالي.
    """
    createServiceRequest(
        input: CreateServiceRequestInput! @spread
        files: [ServiceRequestFileInput!]
    ): ServiceRequestResponse
        @field(resolver: "Najaz\\GraphQLAPI\\Mutations\\App\\Citizen\\ServiceRequestMutation@store")

    """
    تحديث طلب خدمة (للمواطن: فقط notes و form_data).
    """
    updateServiceRequest(
        id: ID!,
        input: UpdateServiceRequestInput! @spread
        files: [ServiceRequestFileInput!]
    ): ServiceRequestResponse
        @field(resolver: "Najaz\\GraphQLAPI\\Mutations\\App\\Citizen\\ServiceRequestMutation@update")

    """
    إلغاء طلب خدمة.
    """
    cancelServiceRequest(id: ID!): StatusResponse
        @field(resolver: "Najaz\\GraphQLAPI\\Mutations\\App\\Citizen\\ServiceRequestMutation@cancel")
}

input CreateServiceRequestInput {
    serviceId: Int! @rename(attribute: "service_id")
    formData: JSON! @rename(attribute: "form_data")
    notes: String
}

input UpdateServiceRequestInput {
    formData: JSON @rename(attribute: "form_data")
    notes: String
}

input ServiceRequestFileInput {
    fieldCode: String! @rename(attribute: "field_code")
    file: Upload!
}

enum ServiceRequestStatus {
    PENDING
    IN_PROGRESS
    COMPLETED
    REJECTED
    CANCELLED
}

type ServiceRequestResponse {
    success: Boolean
    message: String
    request: ServiceRequest
}

type ServiceRequest {
    id: ID!
    serviceId: Int! @rename(attribute: "service_id")
    citizenId: Int! @rename(attribute: "citizen_id")
    status: String!
    formData: JSON @rename(attribute: "form_data")
    notes: String
    completedAt: DateTime @rename(attribute: "completed_at")
    createdAt: DateTime @rename(attribute: "created_at")
    updatedAt: DateTime @rename(attribute: "updated_at")
    service: Service @belongsTo
    citizen: Citizen @belongsTo
    beneficiaries: [Citizen!]! @belongsToMany
}

