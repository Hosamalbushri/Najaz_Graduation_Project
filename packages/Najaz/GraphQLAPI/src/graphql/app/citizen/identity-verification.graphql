# Citizen identity verification APIs

extend type Query @guard(with: ["citizen-api"]) {
    """
    All identity verification requests submitted by the authenticated citizen.
    """
    myIdentityVerifications: [IdentityVerification!]
        @field(resolver: "Najaz\\GraphQLAPI\\Queries\\App\\Citizen\\IdentityVerificationQuery@list")

    """
    Latest identity verification request for the authenticated citizen, if any.
    """
    myLatestIdentityVerification: IdentityVerification
        @field(resolver: "Najaz\\GraphQLAPI\\Queries\\App\\Citizen\\IdentityVerificationQuery@latest")
}

extend type Mutation @guard(with: ["citizen-api"]) {
    """
    Submit a new identity verification request for the authenticated citizen.
    Citizen ID is taken from the token, not from the input.
    """
    requestIdentityVerification(
        input: CitizenIdentityVerificationInput! @spread
    ): IdentityVerificationResponse
        @field(resolver: "Najaz\\GraphQLAPI\\Mutations\\App\\Citizen\\IdentityVerificationMutation@store")

    """
    Update identity verification documents (documents and face video only).
    Allowed only when status is pending or rejected.
    """
    updateMyIdentityVerification(
        id: ID!,
        input: UpdateCitizenIdentityVerificationInput! @spread
    ): IdentityVerificationResponse
        @field(resolver: "Najaz\\GraphQLAPI\\Mutations\\App\\Citizen\\IdentityVerificationMutation@update")

    """
    Delete identity verification request.
    Allowed only when status is pending.
    """
    deleteMyIdentityVerification(
        id: ID!
    ): StatusResponse
        @field(resolver: "Najaz\\GraphQLAPI\\Mutations\\App\\Citizen\\IdentityVerificationMutation@delete")
}

"""
Payload for citizen-driven identity verification requests.
Citizen ID is inferred from the authenticated user.
"""
input CitizenIdentityVerificationInput {
    front_document: Upload
    back_document: Upload
    documents: [Upload!]
    face_video: Upload
}

input UpdateCitizenIdentityVerificationInput {
    front_document: Upload
    back_document: Upload
    documents: [Upload!]
    face_video: Upload
}

